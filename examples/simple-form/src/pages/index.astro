---
import Layout from '../layouts/Layout.astro';
import {BButton, Bind, BindForm, BInput, FormErrors} from '@astro-utils/forms/forms.js';
import {Button} from 'reactstrap';
import 'bootstrap/dist/css/bootstrap.css';


const form = Bind({age: 0, name: ''});
let showSubmitText: string;

function formSubmit(){
    Astro.locals.session.counter ??= 0;
    Astro.locals.session.counter++;
    showSubmitText = `Your name is ${form.name}, you are ${form.age} years old. `;
}

let value = 4;
function makeBackgroundRed() {
    this.style = 'background-color: red';
    value = 5;
    this.innerHTML = 'Clicked ' + this.hidden;
}
---
<Layout title="Form + Session">
    <BButton props={{color: 'info'}} onClick={makeBackgroundRed} hidden={0}>Should click</BButton>

    <BindForm bind={form}>
        {[1, 2, 3].map(key =>
                <BButton props={{color: 'info'}} onClick={makeBackgroundRed} hidden={key}>Should click</BButton>
        )}

        <p>Value: {value}</p>

        <FormErrors/>
        {showSubmitText}

        {Astro.locals.session.counter &&
                <p>You have submitted {Astro.locals.session.counter} times.</p>
        }

        <h4>What you name*</h4>
        <BInput type="text" name="name" maxlength={20} required/>

        <h4>Enter age*</h4>
        <BInput type="int" name="age" required/>

        <BButton as={Button} props={{color: 'info'}} onClick={formSubmit} whenFormOK>Submit</BButton>
    </BindForm>
</Layout>
